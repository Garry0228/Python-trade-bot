******************************************************************************************************************************
				Изменения на 12.10.2021
******************************************************************************************************************************
	1) изменены цветовые индикаторы графика для покупки/продажи.
	2) в блоке настроек все поля (кроме алгоритма и комиссии) теперь вводятся вручную и могут принимать любые значения.
	3) симуляции теперь производятся для каждого алгоритма по отдельности: какой в данный момент выбран, для того и проводим.
	4) в симуляциях алгоритмов больше не учитывается последний цикл, если он не был завершен естественным образом.
Если цикл обрывается в середине или ближе к концу из-за того, что закончились данные для симуляции, то это сильно влияет 
на общий результат, особенно на небольшом периоде. Логика такая, что в реальных условиях цикл завершится так или иначе корректно.
В консоль для этой ситуации добавлено информационное сообщение.
	5) Алгоритмы SMA были переделаны полностью. В список алгоритмов добавлены варианты:
SMA(5)+RSI, SMA(10)+RSI, SMA(20)+RSI, SMA(40)+RSI.
В скобках - размер скользящего окна, RSI - это признак для того, что для точек входа в цикл используем и этот индикатор.
Описание алгоритма:
		- размер окна для подсчета RSI совпадает с размером окна для SMA
		- точкой входа в цикл является начало восходящего тренда: текущая цена пробивает SMA снизу. При этом RSI > 50
		- в рамках начавшегося цикла ловим сигнал на покупку: цена должна отскочить вверх от цены начала цикла на
		  заданный процент (указан в поле /Отступ 1го ордера, %/). Почему вверх, а не вниз: мы зашли по восходящему тренду
		  и должны убедиться, что цена и правда растет.
		- при получении сигнала совершается покупка на сумму 1го ордера.
		- если тренд оказался ложным и после покупки цена упала на процент StopLoss, завершаем цикл с потерей.
		  При этом повышаем сумму следующего ордера на покупку на процент Martingale. Повышать можем столько раз,
		  сколько указано в поле /Количество ордеров/. После чего, если TakeProfit так и не был исполнен, вернемся в самое начало,
		  к сумме 1го ордера.
		- при достижении процента профита (указан в поле /TakeProfit, %/) завершаем цикл в плюс, используя механизм
		  TrailingStop, если он был задан.
		- в случае, если цикл начался, но покупки не было, по таймеру перезапускаем цикл.
	6) график доступен для этих алгоритмов
	7) обозначения в консоли:
		- #цикла: порядковый номер точки входа
		- этап: аналог номера ордера для алгоритма Martingale. Определяет отступ цены покупки от первого ордера.
		  Например, если этап=3, стоимость 1го ордера=100, процент Martingale=200,
		  то цена следующего ордера на покупку будет равна 100+ 100*(3-1)*200/100 = 500. Возможно, стоит исправить увеличение цены, сделав
		  от предыдущего значения, а не от первого, чтобы цена росла более резко.
	8) Замечания к алгоритму SMA: значения параметров должны сильно отличаться от настроек классического Martingale:
количество ордеров нужно сделать меньше, процент Martingale - больше. Какие нужны StopLoss и TakeProfit я пока не понял,
возможно, надо как-то умнее их применять, чем просто заведение константами. Например, они должны подгоняться индивидуально для каждого цикла.
	


******************************************************************************************************************************
				Изменения на 08.10.2021
******************************************************************************************************************************
	1) теперь 2 настройки для отступов: первого и остальных. Хз зачем, возможно будет полезно для дальнейшей автоподгонки параметров.
	2) добавлены варианты количества страховочных ордеров: 30, 40, 50. Позволяет снизить риски засчет большего перекрытия цены.
	3) добавлены варианты для StopLoss: 20%, 30%. Позволяет дольше ждать отскока цены, не совершая преждевременной продажи.
	4) изменен критерий входа в цикл: теперь считаем подходящим моментом, когда RSI < 75.
При RSI > 70 рынок считается перекупленным и предполагается, что цена расти не будет, а падать может долго.
Таким образом, низкое значение RSI больше проблемой не считаем, логика такая: при низком RSI цена растет,
цикл, скорее всего, будет перезапущен по таймеру без убытка. А если вдруг цена упадет, тоже неплохо - 
она, вероятно, отскочит вверх и есть возможность завершить цикл в плюс за 1-2 ордера.
	5) исправлена ошибка механизма StopLoss - теперь он проверяется ДО текущего ордера, а не после
	6) StopLoss был переработан: он сработает, если текущая суммарная стоимость падает ниже суммы безубыточной
продажи на заданный процент. То есть, теперь он не привязан только к последнему ордеру сетки, а считается динамически
с каждым последующим ордером.
	7) добавлена графика по истории торгов. После того, как отработала симуляция, можно нажать кнопку График,
откроется график цены по датам симуляции, на котором отобразим точки входа в каждый цикл, ордера на продажу/покупку 
и сработавшие StopLoss-ы. На большом интервале может быть нагромождение инфы, решается масштабированием графика. На него можно еще
что-то добавить/убрать, но с большим наполнением он начинает тормозить.
	8) симуляцию SMA пока убрал, чтобы не захламляла консоль и не занимала время теста
	9) в режиме симуляции можно, наверное, не учитывать последнюю продажу - т.к. у нас просто заканчиваются тестовые данные
и мы прерываемся в любом месте, например посередине цикла с понижением цены, само собой это получается минус.
На реальной торговле такого не будет, мы доведем цикл до конца согласно настройкам. Наверное, надо как-то выкинуть последний цикл
из результатов в следующей версии программы.
	10) добавил в список валют и акций для симуляции


******************************************************************************************************************************
				Изменения на 05.10.2021
******************************************************************************************************************************
	1) добавлен механизм трейлинг стопа, настройка находится в 5 строке среднего блока.
Суть такая, что при достижении профита сразу не продаем, а фиксируем текущую цену и пытаемся найти лучший момент для продажи.
Когда цена растет (или незначительно падает) тянем цену стопа вслед за ценой. Если цена упала более чем на выбранный процент 
TrailingStop, продаем. Плюсы в том, что можно значительно увеличить итоговый плюс, если цена стопа оказалась в нижней точке тенденции
к росту. Минусы - цикл может надолго застопориться, если цена наоборот решила упасть и никак не хочет расти. Поэтому, большой процент
в настройке лучше не выбирать, самих циклов может стать намного меньше, так как все время будем находиться в ожидании. 
По ощущениям - 0,1 или 0,3. Совсем выключить настройку можно, установив в значение 0
	2) в консоль симуляции добавлен подсчет итогового количества покупок/продаж
	3) в консоль симуляции добавлена раскраска строк с профитом/потерей. Профит зеленый, потеря красная


******************************************************************************************************************************
				Изменения на 29.09.2021
******************************************************************************************************************************
	1) в анализ добавлен расчет осциллятора Relative Strength Index (RSI)
	2) добавлена симуляция на исторических данных по алгоритмам Martingale и SMA_4_10, SMA_20_50. 
Валюту, период и интервалы симуляции выбираем в блоке параметров (1 строка)
	3) В средний блок добавлены параметры алгоритма Martingale:
			1й ордер, $:
				Стоимость первого ордера. С нее стартуем, далее увеличиваем на фиксированный %
			Отступ ордера, %:
				На этот процент уменьшается с каждым ордером входная цена
			Количество ордеров:
				количество ордеров в сетке. Чем больше, тем больший должен быть депозит для покупок
			Martingale, %:
				На этот процент увеличиваем стоимость каждого последующего ордера
			TakeProfit, %:
				процент желаемой прибыли. При достижении продаем спот, фиксируем прибыль, выходим из текущего цикла покупок 
				и пробуем начать новый
			StopLoss, %:
				процент убытка. Если после реализации последнего ордера цена продолжает уменьшаться, при достижении продаем спот,
				фиксируем убыток, выходим из текущего цикла покупок и пробуем начать новый
			Комиссия, %:
				комиссия брокера. Учитываем при расчете прибыли. На Binance это 0.1% (0.075% если на счету есть BNB).
				Предполагаем, что у нас на кошельке есть BNB, чтобы оплатить комиссию
			Перезапуск, мин:
				Таймер, по которому перезапустим неудачный цикл (зашли в цикл, сформировали ордера, но цена не падает до нужной отметки)
	4) при симуляции заполняем текстовый блок ордеров (внизу слева). Там ВСЕ ордера, пронумерованные, с ценой и суммой покупки.
Исполнятся при этом совсем не факт, что все. В этом блоке показываем все для наглядности и контроля процесса
	5) текстовый блок процесса симуляции (внизу справа) отображает такую инфу:
			- № цикла, дата и время старта
			- признак перезапуска (если он был) с датой и временем
			- номер, цена и сумма сработавшего ордера
			- подытог цикла с суммами покупки, продажи и профита/потери
			- после всех циклов в симуляции выводим итоги: покупка, продажа, комиссия, итого, размер депозита, % профита по отношению к депозиту
	6) для алгоритмов SMA_4_10 и SMA_20_50 убраны промежуточные результаты, показан только итог по итогам симуляции.
По моим наблюдениям - эти алгоритмы не подходят для спотовой торговли. Возможно, будут норм для режима инвестиций, либо по ним также надо применять
алгоритм нескольких ордеров с повышающей стоимостью. Это пока ХЗ
	7) прогрессбар отдельно для каждого аглоритма (будет норм для большого окна данных симуляции)
	8) по каждому процессу в каталог программы сохраняем результаты в формате CSV (текстовый файл, но может быть открыт в Excel):
			ticker.csv:
				выгрузка исторических данных с агрегатора за период
			analize_tick.csv:
				для режима анализа, выгрузка по всем валютам из белого листа с индикаторами волатильности и тренда
			ticker_MG.csv:
				полная статистика по аглоритму Martingale (частично продублирована в консоли программы)
			ticker_sma4_10.csv
				полная статистика по аглоритму SMA_4_10
			ticker_sma20_50.csv
				полная статистика по аглоритму SMA_20_50
Файлы полной статистики полезны, если надо найти косяки в алгоритмах. А они наверняка есть и будут.
Также по ним можно делать дальнейшие предположения по улучшению алгоритмов

В дальнейших планах:
	сделать автоподгонку параметров алгоритма Martingale для поиска наилучших вариантов работы.
	Подгонку предполагаю проводить на том же самом историческом наборе, что и симуляцию.
	После чего, просто выставлять их и торговать (до следующей симуляции и автоподгонки).
	Так сказать, ИИ на минималках
В дальнейших планах:
	подключить API Binance и начать уже торговать, сколько можно ждать



******************************************************************************************************************************
				Изменения на 24.09.2021
******************************************************************************************************************************

	1) Виджет телеги (верхний блок) временно остановлен, кнопки Старт/Стоп отключены. Проблема в конфликтах слушателя сообщений, 
нужно выделять отдельный процесс для бота, к которому будут подключаться все текущие сеансы. Возможно, стоит переделать форму, 
убрав этот блок и освободить место для дополнительных настроек.
	2) В блок настроек и бектеста (средний блок) добавлены поля Депозит и Алгоритм. Пока сам процесс симуляции торгов не реализован, 
будет на следующем этапе.
	3) Добавлены кнопки Анализ и Симуляция (бэктест). Пока работает только Анализ.
	4) Анализ загружает исторические данные по всем спотам за фиксированный период и интервал с агрегатора Yfinance.
Период - 2 месяца, интервал - 1 день. Цель - расчитать индикаторы волатильности и силы тренда.
Эти индикаторы используются для принятия решения о входе в рынок. Сами индикаторы, принцип расчета среднего и алгорим трактовки
можно скорректировать. Используем для этого библиотеку Technical Analysis Library с TradingView.
В данный момент для всех индикаторов считаем средние значения за последние 30 дней и 7 дней, а также текущее значение.
Список индикаторов: 
			Volume: 
				объем в миллионах, 
			Spot close price: 
				цена закрытия, 
			Average True Range (ATR):
				идикатор волатильности, считаем абсолютное значение в % от цены закрытия,
				так как просто ATR имеет относительный характер и не подходит для сравнения.
				Формула data['volatility_atr']/data['Close']*100.
				Предположительно: значение от 2-4 считается приемлемым для входа в рынок,
				т.е. волатильность достаточно большая, чтобы заработать на колебаниях цены,
				но при этом не чрезмерная. Когда ATRp меньше 2 - штиль на рынке, больше 4 - буря.\
				Но это спорно, возможно верхнюю границу стоит скорректировать до 7-10, у популярной крипты
									   этот показатель стабильно высок и гораздо выше, чем у обычных акций.
			Bollinger Bands (BB), SMA:
				идикатор волатильности полосы Боллинждера, считаем среднее по медиане (средняя линия).
				Не знаю, как трактовать, возможно надо еще как-то сравнить с ценой закрытия.
				Основным показателем все равно является ширина полосы и направление, а также пробития макс/мин значений.
				Но это скорее индикаторы момента, а не волатильности
			Bollinger Bands (BB) width, %:
				абсолютное значение ширины полосы в %. Формула (data['volatility_bbh']-data['volatility_bbl'])/data['Close']*100
				Возможно, стоит добавить трактовку значений. <20 - штиль, >40 - шторм. Или по-другому
			Commodity Channel Index:
				 Индекс Товарного Канала. Относится не к волатильности, а к осцилляторам или индикаторам тренда.
				 измеряет отклонение цены инструмента от его среднестатистической цены.
				 Имеется трактовка: диапазон ±100 считается приемлемым для рынка. Значения выше +100 говорят о состоянии перекупленности 
				 (и вероятности корректирующего спада), а значения ниже -100 — о состоянии перепроданности (и вероятности корректирующего подъема)
	5) Добавлен текстовый блок для сетки ордеров по алгориму Martingale (нижний фрейм, слева). Будет реализовано позднее.
	6) По поводу API биржи - планирую подключить Binance, так как у них наиболее внятное API (у того же Тинькова есть три варианта
API на питоне, но все они неофициальные и мне пока нихрена не понятно, как ими пользоваться). В качестве валюты для старта торгов
думаю, надо использовать бакс: USD или USDT. Про мультивалютный кошелек пока не думал, возможно позднее.
	7) По поводу алгорима торгов - для начала это будет Matringale LONG, так как предполагаем, что каждый раз у нас есть валюта номер 2, то есть бакс.
Я пока не очень понял, как именно LONG переворачивается на SHORT и надо ли это вообще.
	8) В дальнейшем будет подгонка параметров алгоритма в процессе симуляции на исторических данных и выбор лучших - ИИ, так сказать, в деле.
А также можно сделать альтернативный источник сигналов, то есть не рассчитывать их самим, а брать с платформы TradingView в реальном времени